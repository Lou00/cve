FROM ubuntu:18.04
ENV DEBIAN_FRONTEND=noninteractive
RUN set -ex && \
    sed -i "s/security.ubuntu.com/mirrors.aliyun.com/g" /etc/apt/sources.list && \
    sed -i "s/archive.ubuntu.com/mirrors.aliyun.com/g" /etc/apt/sources.list  && \
    apt-get update 
RUN set -ex && \ 
    apt-get install -y php7.2 && \
    apt-get install -y apache2 && \
    apt-get install -y zip && \
    apt-get install -y composer && \
    apt-get install -y unzip && \
    apt-get install -y libapache2-mod-php && \ 
    apt-get install -y php-mbstring && \ 
    apt-get install -y php7.2-xml
RUN set -ex && \
    composer config -g repo.packagist composer https://mirrors.aliyun.com/composer/ && \
    composer create-project --prefer-dist laravel/laravel laravel-5.7.28 "5.7.28"

RUN set -ex && \
    mv ./laravel-5.7.28 /var/ && \
    rm -rf /var/www/ && \ 
    mv /var/laravel-5.7.28 /var/www && \
    mv /var/www/public /var/www/html
COPY ./file /file
RUN set -ex && \
    mv /file/run.sh /run.sh && \
    mv /file/web.php /var/www/routes/web.php && \
    mv /file/IndexController.php /var/www/app/Http/Controllers
RUN set -ex && \ 
    chmod +x /run.sh && \
    chmod 777 /var/www/storage/logs && \
    chmod 777 /var/www/storage/framework/*
RUN set -ex && \ 
    cd /var/www && php artisan key:generate
WORKDIR /var/www/html
CMD /bin/bash /run.sh

